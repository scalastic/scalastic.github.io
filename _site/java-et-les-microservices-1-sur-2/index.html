<!DOCTYPE html>
<html lang="fr">
<head>
	<meta charset="utf-8">
	<title>Java et les microservices ? - Bonjour, je suis Jean-Jérôme Lévy</title>

  <!-- Edit site and author settings in `_config.yml` to make the social details your own -->

    <meta content="Bonjour, je suis Jean-Jérôme Lévy" property="og:site_name">
  
    <meta content="Java et les microservices ?" property="og:title">
  
  
    <meta content="article" property="og:type">
  
  
    <meta content="Avec l'arrivée des architectures microservices, les développeurs Java sont en droit d'avoir peur pour leurs applications. Temps de démarrage, consommation mémoire de la JVM, a priori, rien de bon pour implémenter une application à base de microservices..." property="og:description">
  
  
    <meta content="https://www.scalastic.io/java-et-les-microservices-1-sur-2/" property="og:url">
  
  
    <meta content="2021-03-13T14:21:20+01:00" property="article:published_time">
    <meta content="https://www.scalastic.io/about/" property="article:author">
  
  
    <meta content="https://www.scalastic.io/assets/img/java-like-rusty-container.jpg" property="og:image">
  
  
    
  
  
    
    <meta content="Java" property="article:tag">
    
    <meta content="Microservices" property="article:tag">
    
  

    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@">
    <meta name="twitter:creator" content="@">
  
    <meta name="twitter:title" content="Java et les microservices ?">
  
  
    <meta name="twitter:url" content="https://www.scalastic.io/java-et-les-microservices-1-sur-2/">
  
  
    <meta name="twitter:description" content="Avec l'arrivée des architectures microservices, les développeurs Java sont en droit d'avoir peur pour leurs applications. Temps de démarrage, consommation mémoire de la JVM, a priori, rien de bon pour implémenter une application à base de microservices...">
  
  
    <meta name="twitter:image:src" content="https://www.scalastic.io/assets/img/java-like-rusty-container.jpg">
  

	<meta name="description" content="Avec l'arrivée des architectures microservices, les développeurs Java sont en droit d'avoir peur pour leurs applications. Temps de démarrage, consommation mémoire de la JVM, a priori, rien de bon pour implémenter une application à base de microservices...">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta property="og:image" content="">
	<link rel="shortcut icon" href="/assets/img/favicon/favicon.ico" type="image/x-icon">
	<link rel="apple-touch-icon" href="/assets/img/favicon/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicon/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicon/apple-touch-icon-144x144.png">
	<!-- Chrome, Firefox OS and Opera -->
	<meta name="theme-color" content="#263959">
	<!-- Windows Phone -->
	<meta name="msapplication-navbutton-color" content="#263959">
	<!-- iOS Safari -->
	<meta name="apple-mobile-web-app-status-bar-style" content="#263959">
	<!-- Google Fonts -->
	<link href="https://fonts.googleapis.com/css?family=PT+Serif:400,700|Lato:300,400,700&display=swap" rel="stylesheet">
	<!-- Font Awesome -->
	<link rel="stylesheet" href="/assets/fonts/fontawesome/css/all.min.css">
	<!-- Styles -->
	<link rel="stylesheet" href="/assets/css/main.css">
</head>

<body>

  <div class="wrapper">
    <aside class="sidebar">
  <header>
    <div class="about">
      <div class="cover-company-image">
        <a href="/"><img src="/assets/img/scalastic.png" alt="Scalastic"></a>
      </div>
      <div class="cover-author-image">
        <a href="/"><img src="/assets/img/jean-jerome-levy.jpg" alt="Jean-Jérôme Lévy"></a>
      </div>
      <div class="author-name">Jean-Jérôme Lévy</div>
      <p>Bonjour,<br> Je suis un consultant freelance DevOps spécialisé dans le CI/CD, Docker/Kubernetes et le Cloud.</p>
      <p>J'officie au sein de la société Scalastic.</p>
    </div>
  </header> <!-- End Header -->
  <footer>
    <section class="contact">
      <h3 class="contact-title">Contactez-moi</h3>
      <ul>
        
        
          <li class="github"><a href="http://github.com/jeanjerome" target="_blank"><i class="fab fa-github-square"></i></a></li>
        
        
          <li class="linkedin"><a href="https://in.linkedin.com/in/jean-jerome-levy" target="_blank"><i class="fab fa-linkedin"></i></a></li>
        
        
          <li class="email"><a href="mailto:contact@scalastic.io"><i class="fas fa-envelope-square"></i></a></li>
        
      </ul>
    </section> <!-- End Section Contact -->
    <div class="copyright">
      <p>2021 &copy; Jean-Jérôme Lévy pour Scalastic </p>
      <p>Contenu sous licence <a href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons"></i> BY 4.0</a> à l'exception d'indication contraire<p>
    </div>
  </footer> <!-- End Footer -->
</aside> <!-- End Sidebar -->
<div class="content-box clearfix">
  <article class="article-page">
  <div class="page-content">
    
    <div class="page-cover-image">
      <figure>
        <img class="page-image" src=/assets/img/java-like-rusty-container.jpg alt="Java et les microservices ?">
        
          <figcaption>Photo de a-herzog trouvée sur Flickr (Licence Attribution 2.0 Générique - CC BY 2.0)</figcaption>
        
      </figure>
    </div> <!-- End Page Cover Image -->
    
    <div class="wrap-content">
      <header class="header-page">
        <h1 class="page-title">Java et les microservices ?</h1>
        <div class="page-date"><span>2021, Mar 13&nbsp;&nbsp;&nbsp;&nbsp;</span></div>
      </header>
      <p>Cet article est le premier d’une série abordant les concepts derrière GraalVM. Il permet de bien se rendre compte des lacunes de Java et de sa JVM HotSpot dans le monde des containers et notamment des microservices.</p>

<!--more-->

<hr class="hr-text" data-content="Plan" />

<ol>
  <li><a href="#quest-ce-quun-microservice-">Qu’est-ce qu’un microservice ?</a></li>
  <li><a href="#quest-ce-que-java-">Qu’est-ce que Java ?</a>
    <ol>
      <li><a href="#le-fonctionnement-de-la-jvm">Le fonctionnement de la JVM</a>
        <ol>
          <li><a href="#linterprétation">L’interprétation</a></li>
          <li><a href="#le-compilateur-just-in-time-jit">Le compilateur Just-In-Time (JIT)</a></li>
          <li><a href="#lempreinte-mémoire">L’empreinte mémoire</a></li>
        </ol>
      </li>
      <li><a href="#le-fonctionnement-des-frameworks-java">Le fonctionnement des Frameworks Java</a></li>
    </ol>
  </li>
  <li><a href="#on-fait-comment-à-présent-">On fait comment à présent ?</a></li>
</ol>

<hr class="hr-text" data-content="Microservices" />

<h2 id="quest-ce-quun-microservice-">Qu’est-ce qu’un microservice ?</h2>

<p>Le prolongement (l’aboutissement ?) du concept de <code class="language-plaintext highlighter-rouge">SOA</code> (Architecture Orientée Service) avec l’avênement du cloud.</p>

<p>Il ajoute les notions de :</p>

<ul>
  <li>service conçu pour remplir <strong>1 seule fonction</strong> (par exemple, la gestion des utilisateurs)</li>
  <li><strong>élastique</strong> (facilement scalable) donc nécessite un déploiement rapide, un service léger, dans le cloud,…</li>
  <li><strong>automatisation</strong> du processus de build et de déploiement, équipe dédiée et réduite, tests automatisés pour déployer rapidement une nouvelle version,…</li>
</ul>

<div class="premonition info">
  <i class="premonition pn-info"></i>
  <div class="content">
    <p><code class="language-plaintext highlighter-rouge">FaaS</code> va encore plus loin en ajoutant « <em>serverless</em> » (sans se soucier du déploiement) et « <em>sans état</em> » ( programmation fonctionnelle, x -&gt; f(x) )</p>




  </div>
</div>

<hr class="hr-text" data-content="Java" />

<h2 id="quest-ce-que-java-">Qu’est-ce que Java ?</h2>

<h3 id="le-fonctionnement-de-la-jvm">Le fonctionnement de la JVM</h3>

<hr class="hr-text" data-content="Interpréteur" />

<h4 id="linterprétation">L’interprétation</h4>

<p><img src="/assets/img/jvm-execution.png" alt="Exécution de la JVM" /></p>

<ol>
  <li>La JVM est un exécutable qui lit du bytecode puis l’interprète.</li>
  <li>Le bytecode est dans des packages .jar sous forme de fichiers .class</li>
  <li>La JVM <strong>recherche</strong> le fichier .class dans les packages .jar, <strong>vérifie</strong> le fichier .class puis le charge</li>
  <li>Une fois que le bytecode est chargé, la JVM peut l’exécuter (<strong>le semi-interpréter</strong>)</li>
</ol>

<div class="premonition warning">
  <i class="premonition pn-warn"></i>
  <div class="content">
    <p>Exécuter du bytecode a donc un coût :</p>

<ul>
  <li>Le bytecode est recherché, vérifié puis interprété par la JVM qui elle-même s’exécute sur le processeur.</li>
</ul>




  </div>
</div>

<hr class="hr-text" data-content="Compilateur JIT" />

<h4 id="le-compilateur-just-in-time-jit">Le compilateur Just-In-Time (JIT)</h4>

<p><img src="/assets/img/jvm-jit.png" alt="Le compilateur JIT" /></p>

<ol>
  <li>Lors de l’exécution d’une méthode Java, le compilateur <code class="language-plaintext highlighter-rouge">C1</code> de JIT (just-in-time, à la volée) va la compiler en code natif et le <code class="language-plaintext highlighter-rouge">Profiler</code> va commencer à recueillir des informations sur son utilisation.</li>
</ol>

<div class="premonition info">
  <i class="premonition pn-info"></i>
  <div class="content">
    <p>C1 est un compilateur léger et rapide mais il ne produit pas du code natif optimisé.</p>




  </div>
</div>

<ol>
  <li>Losrque le profiler détecte une méthode très utilisée, « <strong><em>Hot</em></strong> », le compilateur <code class="language-plaintext highlighter-rouge">C2</code> va se servir des informations du Profiler pour produire un code natif, <strong>agressif</strong>,  optimisé et très bien adapté au contexte d’utilisation.</li>
</ol>

<div class="premonition info">
  <i class="premonition pn-info"></i>
  <div class="content">
    <p>C2 est un compilateur lourd et lent mais il produit un code natif très bien optimisé et très rapide.</p>




  </div>
</div>

<div class="premonition note">
  <i class="premonition pn-note"></i>
  <div class="content">
    <p>Il y a en réalité un cycle entre la compilation C1 et C2. Le compilateur C2 va souvent recompiler des morceaux de bytecode avec de nouvelles informations provenant du profiler pour produire un binaire toujours plus optimal.</p>




  </div>
</div>

<ol>
  <li>Au bout d’un certain temps, lorsque de nombreux morceaux de bytecode auront été compilés par le compilateur C2, l’application Java fonctionnera très rapidement.</li>
</ol>

<div class="premonition warning">
  <i class="premonition pn-warn"></i>
  <div class="content">
    <ul>
  <li>Il faut donc un temps de chauffe, « <strong><em>warm-up</em></strong> », à une application Java pour être pleinement fonctionnelle.</li>
  <li>C’est un réel problème pour un microservice qui doit pouvoir être déployé et fonctionnel très rapidement.</li>
</ul>




  </div>
</div>

<hr class="hr-text" data-content="Mémoire" />

<h4 id="lempreinte-mémoire">L’empreinte mémoire</h4>

<h5 id="architecture-générale-de-la-jvm">Architecture générale de la JVM</h5>
<p><img src="/assets/img/jvm-architecture.png" alt="Architecture mémoire d'une JVM" /></p>

<h5 id="détail-de-2-espaces-mémoires">Détail de 2 espaces mémoires</h5>
<p><img src="/assets/img/jvm-memory.png" alt="Focus sur des espaces mémoires de la JVM" /></p>

<p>La JVM alloue de la mémoire pour l’application mais aussi pour ses propres métadonnées et son fonctionnement :</p>

<ol>
  <li>
    <p>Le « <strong><em>Java Heap</em></strong> » stocke les instances des objets Java.
Il est divisé en 2 parties : le « <strong><em>Young Generation</em></strong> » qui contient les objets récemment créés et le « <strong><em>Tenured Generation</em></strong> » qui contient lui des objets qui ont résisté au ramasse-miettes (« <strong><em>Garbage Collector</em></strong> »).</p>
  </li>
  <li>
    <p>Le « <strong><em>Metaspace</em></strong> » (anciennement «<em>PermGen</em>») contient les métadonnées des classes (le bytecode des méthodes, les symboles, les «constant pools», les annotations…).</p>
  </li>
</ol>

<div class="premonition warning">
  <i class="premonition pn-warn"></i>
  <div class="content">
    <ul>
  <li>Pour une application de 10Mo, la JVM occupe souvent une taille de 100Mo.</li>
  <li>Là encore, c’est un problème pour un microservice qui doit avoir une empreinte mémoire la plus petite possible.</li>
</ul>




  </div>
</div>

<hr class="hr-text" data-content="Frameworks" />

<h3 id="le-fonctionnement-des-frameworks-java">Le fonctionnement des Frameworks Java</h3>

<p>Prenons le cas de Spring et Hibernate comme exemple puisque ce sont, là, 2 frameworks les plus couramment utilisés dans les applications Java.</p>

<p>Lorsqu’une application Java, contenant ces frameworks, démarre, voici ce qui se passe :</p>

<ul>
  <li>Lecture et parsing des fichiers de configuration,</li>
  <li>Scanne complet des classes pour récupérer les métadonnées (annotations, accesseurs,…),</li>
  <li>Création d’un métamodèle,</li>
  <li>Préparation de la réflexion,</li>
  <li>Création des proxies (beaucoup de proxies !),…</li>
</ul>

<p>Ce sont pourtant des frameworks très utilisés par les développeurs et, en réalité, très bien adaptés aux applications monolithiques.</p>

<div class="premonition warning">
  <i class="premonition pn-warn"></i>
  <div class="content">
    <ul>
  <li>Les frameworks Java amplifient les problèmes de temps de démarrage et de consommation mémoire de la JVM.</li>
</ul>




  </div>
</div>

<hr class="hr-text" data-content="Conclusion" />

<h2 id="on-fait-comment-à-présent-">On fait comment à présent ?</h2>

<p>On oublie Java ? On se met tous au C++ ??</p>

<p>Rien de tout cela bien sûr. La réponse dans un prochain article présentant GraalVM. Et vous allez voir que ça déménage !</p>

<p>Cheers…</p>

<div class="premonition info">
  <i class="premonition pn-info"></i>
  <div class="content">
    <p class="header">Et maintenant</p><ul>
  <li>Vous avez aimé cet article ? Dites-le ci-dessous afin que le blog gagne en visibilité.</li>
  <li>Vous avez une question ? Posez-la en commentaire, je m’efforcerai d’y répondre dans les plus bref délais !!</li>
</ul>

<p>Merci à vous !</p>




  </div>
</div>

      <div class="page-footer">
        <div class="page-share">
          <a href="https://twitter.com/intent/tweet?text=Java et les microservices ?&url=https://www.scalastic.io/java-et-les-microservices-1-sur-2/" title="Share on Twitter" rel="nofollow" target="_blank"><i class="fa fa-twitter" aria-hidden="true"></i>&nbsp;Twitter</a>
          <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://www.scalastic.io/java-et-les-microservices-1-sur-2/" title="Share on LinkedIn" rel="nofollow" target="_blank"><i class="fa fa-linkedin" aria-hidden="true"></i>&nbsp;LinkedIn</a>
        </div>
        <div class="page-tag">
          
            <a href="/tags#Java" class="tag">&#35; Java</a>
          
            <a href="/tags#Microservices" class="tag">&#35; Microservices</a>
          
        </div>
      </div>
      <section class="comment-area">
  <div class="comment-wrapper">
    
    <div id="disqus_thread" class="article-comments"></div>
    <script>
      (function() {
          var d = document, s = d.createElement('script');
          s.src = '//scalastic.disqus.com/embed.js';
          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
      })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    
  </div>
</section> <!-- End Comment Area -->

    </div> <!-- End Wrap Content -->
  </div> <!-- End Page Content -->
</article> <!-- End Article Page -->

</div>

  </div>
  
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', '', 'auto');
  ga('send', 'pageview');
</script> <!-- End Analytics -->

</body>
</html>
